services:
  # --- Dev mode: game server with Metamod extension ---
  insurgency:
    image: insurgencysamrtbots-insurgency
    build:
      context: .
      dockerfile: insurgency-server/Dockerfile
    container_name: insurgency-server
    restart: unless-stopped
    ports:
      - "27025:27025/udp"
      - "27025:27025/tcp"
    environment:
      - SERVER_HOSTNAME=${SERVER_HOSTNAME:-Insurgency Smart Bots Dev Server}
      - SERVER_PASSWORD=${SERVER_PASSWORD:-}
      - RCON_PASSWORD=${RCON_PASSWORD:-changeme}
      - MAX_PLAYERS=${MAX_PLAYERS:-32}
      - START_MAP=${START_MAP:-ministry_coop}
      - GAME_MODE=${GAME_MODE:-checkpoint}
      - TICKRATE=${TICKRATE:-64}
      - NB_DEBUG=${NB_DEBUG:-0}
      - HARD_BOTS=${HARD_BOTS:-0}
      - DEV_MODE=${DEV_MODE:-0}
      - CONTROLLED_TEAM=${CONTROLLED_TEAM:-3}

    stdin_open: true
    tty: true
    profiles:
      - dev

  # --- Vanilla debug mode: original bot AI + nb_debug logging ---
  insurgency-vanilla:
    build:
      context: .
      dockerfile: insurgency-server/Dockerfile
    container_name: insurgency-vanilla
    restart: unless-stopped
    ports:
      - "27025:27025/udp"
      - "27025:27025/tcp"
    entrypoint: /home/steam/entrypoint-vanilla.sh
    environment:
      - START_MAP=${START_MAP:-ministry_coop}
      - MAX_PLAYERS=${MAX_PLAYERS:-32}
      - TICKRATE=${TICKRATE:-64}
    stdin_open: true
    tty: true
    profiles:
      - vanilla
