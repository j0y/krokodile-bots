version: '3.8'

services:
  insurgency:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: insurgency-server
    restart: unless-stopped
    network_mode: host
    volumes:
      - ./cfg:/home/steam/insurgency-server/insurgency/cfg/custom:ro
      - ./plugins:/home/steam/insurgency-server/insurgency/addons/sourcemod/plugins/custom:ro
    environment:
      - SERVER_HOSTNAME=Insurgency Smart Bots Dev Server
      - SERVER_PASSWORD=
      - RCON_PASSWORD=changeme
      - MAX_PLAYERS=32
      - START_MAP=ministry_coop
      - GAME_MODE=coop
      - TICKRATE=64
      # For the Python AI bridge (optional)
      - AI_BRIDGE_ENABLED=0
      - AI_BRIDGE_HOST=ai-brain
      - AI_BRIDGE_PORT=9000
    stdin_open: true
    tty: true

  # Optional: Python AI brain service for advanced bot logic
  ai-brain:
    build:
      context: ./ai-brain
      dockerfile: Dockerfile
    container_name: insurgency-ai
    restart: unless-stopped
    ports:
      - "9000:9000"
    volumes:
      - ./ai-brain/src:/app/src
    environment:
      - RCON_HOST=127.0.0.1
      - RCON_PORT=27025
      - RCON_PASSWORD=changeme
    depends_on:
      - insurgency
    profiles:
      - ai  # Only starts with: docker compose --profile ai up
